<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Quizlet Learn Clone with Save</title>
  <style>
    body {
      font-family: system-ui, sans-serif;
      background: #f6f7fb;
      margin: 0;
      padding: 20px;
    }
    .container {
      max-width: 600px;
      margin: auto;
    }
    textarea {
      width: 100%;
      height: 250px;
      font-family: monospace;
      padding: 10px;
      box-sizing: border-box;
    }
    button {
      padding: 10px 16px;
      font-size: 16px;
      cursor: pointer;
      margin-top: 10px;
    }
    .card {
      background: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      margin-bottom: 20px;
    }
    .hidden {
      display: none;
    }
    .prompt {
      font-size: 24px;
      margin-bottom: 15px;
    }
    input[type="text"] {
      width: 100%;
      font-size: 18px;
      padding: 8px;
      box-sizing: border-box;
    }
    .feedback {
      margin-top: 10px;
      font-weight: bold;
    }
    .correct { color: green; }
    .incorrect { color: red; }
    .progress {
      margin-top: 15px;
      color: #555;
    }
    .streak {
      margin-top: 8px;
      font-size: 14px;
      color: #666;
    }
  </style>
</head>
<body>

<h1>Quizlet Learn (Clone with Save)</h1>

<div class="container">
  <!-- Paste Mode -->
  <div class="card" id="pasteCard">
    <h2>Paste Quizlet Set</h2>
    <p>Format: <code>term[TAB]answer1;answer2</code></p>
    <textarea id="dataInput" placeholder="adult	å¤§äºº;ãŠã¨ãª"></textarea>
    <button onclick="startLearn(false)">Start Learn Mode</button>
  </div>

  <!-- Learn Mode -->
  <div class="card hidden" id="learnCard">
    <h2>Learn Mode</h2>
    <div id="learnArea"></div>
  </div>
</div>

<script>
  let cards = [];
  let queue = [];
  let current = null;
  let lastCard = null;
  let correctionMode = false;
  let isTransitioning = false;

  function showLearnMode() {
    document.getElementById("pasteCard").classList.add("hidden");
    document.getElementById("learnCard").classList.remove("hidden");
  }

  function saveProgress() {
    localStorage.setItem('quizletLearn', JSON.stringify(cards));
  }

  function loadProgress() {
    const saved = localStorage.getItem('quizletLearn');
    if (!saved) return false;
    try {
      cards = JSON.parse(saved);
      return true;
    } catch(e) {
      return false;
    }
  }

  function rebuildQueue() {
    queue = cards.filter(c => c.streak < 2);
    queue.sort(() => Math.random() - 0.5);
  }

  function startLearn(fromSaved) {
    if (!fromSaved) {
      const raw = document.getElementById("dataInput").value.trim();
      if (!raw) return;

      cards = raw.split("\n").map(line => {
        const [term, answers] = line.split("\t");
        return {
          term: term.trim(),
          answers: answers.split(";").map(a => a.trim().toLowerCase()),
          streak: 0
        };
      });
    }

    lastCard = null;
    correctionMode = false;
    isTransitioning = false;

    saveProgress();
    showLearnMode();
    nextCard();
  }

  function nextCard() {
    rebuildQueue();

    if (queue.length === 0) {
      document.getElementById("learnArea").innerHTML = `
        <h3>ðŸŽ‰ All cards mastered!</h3>
        <p>You answered every card correctly twice.</p>
      `;
      localStorage.removeItem('quizletLearn');
      return;
    }

    if (queue.length > 1 && queue[0] === lastCard) {
      queue.push(queue.shift());
    }

    current = queue[0];
    lastCard = current;
    correctionMode = false;
    isTransitioning = false;

    renderPrompt();
  }

  function renderPrompt() {
    document.getElementById("learnArea").innerHTML = `
      <div class="prompt">${current.term}</div>
      <input type="text" id="answerInput" />
      <button onclick="checkAnswer()">Check</button>
      <div class="feedback" id="feedback"></div>
      <div class="streak">Progress: ${current.streak} / 2</div>
      <div class="progress">Remaining cards: ${queue.length}</div>
    `;

    const input = document.getElementById("answerInput");

    setTimeout(() => {
      input.focus();
      input.select();
    }, 0);

    input.addEventListener("keydown", e => {
      if (e.key === "Enter") checkAnswer();
    });
  }

  function checkAnswer() {
    if (isTransitioning) return;

    const inputEl = document.getElementById("answerInput");
    const input = inputEl.value.trim().toLowerCase();
    const feedback = document.getElementById("feedback");

    if (correctionMode) {
      if (current.answers.includes(input)) {
        feedback.textContent = "âœ” Locked in. You'll see this again.";
        feedback.className = "feedback correct";

        isTransitioning = true;
        inputEl.disabled = true;

        setTimeout(() => {
          isTransitioning = false;
          saveProgress();
          nextCard();
        }, 700);
      } else {
        feedback.innerHTML = `
          Incorrect.<br>
          Correct answers: <strong>${current.answers.join(", ")}</strong><br>
          <em>Please type the correct answer to continue.</em>
        `;
        feedback.className = "feedback incorrect";
      }
      return;
    }

    if (current.answers.includes(input)) {
      current.streak++;
      feedback.textContent = "Correct!";
      feedback.className = "feedback correct";

      isTransitioning = true;
      inputEl.disabled = true;

      saveProgress();

      setTimeout(() => {
        isTransitioning = false;
        nextCard();
      }, 600);

    } else {
      current.streak = 0;
      correctionMode = true;

      feedback.innerHTML = `
        Incorrect.<br>
        Correct answers: <strong>${current.answers.join(", ")}</strong><br>
        <em>Please type the correct answer to continue.</em>
      `;
      feedback.className = "feedback incorrect";

      inputEl.value = "";
      inputEl.focus();

      saveProgress();
    }
  }

  window.addEventListener('load', () => {
    const saved = localStorage.getItem('quizletLearn');
    if (saved) {
      if (confirm("Resume previous session?")) {
        if (loadProgress()) {
          showLearnMode();
          startLearn(true);
          return;
        }
      }
      localStorage.removeItem('quizletLearn');
    }
  });
</script>

</body>
</html>
